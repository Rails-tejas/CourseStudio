<style>
  .form-label-custom {
    font-weight: 500;
    margin-bottom: 6px;
    display: block;
    color: #333;
  }

  .form-control-custom {
    border: 1px solid #ccc;
    border-radius: 12px;
    padding: 12px 16px;
    font-size: 16px;
    background-color: #fff;
    margin-bottom: 20px;
    width: 100%;
  }

  .form-control-custom:focus {
    border-color: #18bc9c;
    outline: none;
  }

  .btn-save {
    background-color: #18bc9c;
    color: white;
    border: none;
    border-radius: 30px;
    padding: 10px 26px;
    font-weight: 500;
  }

  .btn-save:hover {
    background-color: #148f77;
  }

  .profile-gradient {
    background: linear-gradient(135deg, #18bc9c, #2c3e50);
    color: #fff;
  }

  .btn-light-outline {
    border: 1px solid white;
    color: white;
    background: transparent;
  }

  .btn-light-outline:hover {
    background-color: white;
    color: #18bc9c;
  }

  .avatar-preview {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
  }

  @media (max-width: 991.98px) {
    .form-column,
    .card-column {
      flex: 0 0 100%;
      max-width: 100%;
    }

    .card-column {
      margin-top: 2rem;
    }
  }
</style>

<div class="container py-5">
  <div class="row d-flex flex-wrap">
  

    <div class="col-lg-4 card-column">
      <div class="card border-0 shadow-sm p-4 rounded-4 text-center d-flex flex-column align-items-center profile-gradient">
        
   
        <div class="position-relative mb-3">
          <% if @profile.avatar.attached? %>
            <img id="avatarPreview" src="<%= url_for(@profile.avatar) %>" alt="Avatar" class="avatar-preview shadow">
          <% else %>
            <div id="avatarPreview" class="rounded-circle shadow d-flex align-items-center justify-content-center" style="width: 100px; height: 100px; background-color: white; color: #18bc9c; font-size: 32px;">
              <%= @profile.name&.first&.upcase || current_user.email.first.upcase %>
            </div>
          <% end %>

       
          <%= form_with(model: @profile, url: profile_path(@profile), html: { multipart: true }, method: :patch) do |f| %>
            <label class="btn btn-light-outline btn-sm rounded-pill mt-3" style="cursor: pointer;">
              Edit Avatar
              <%= f.file_field :avatar, class: "d-none", onchange: "previewAvatar(this); this.form.submit();" %>
            </label>
          <% end %>
        </div>

        <h5 class="fw-bold mb-1 text-white"><%= @profile.name.presence || current_user.email %></h5>
        <p class="text-light mb-3"><%= @profile.bio.presence || "No bio added." %></p>

        <div class="d-grid gap-2 w-100 mt-2">
          <%= button_to "Logout", destroy_user_session_path, method: :delete, class: "btn btn-light-outline rounded-pill btn-sm" %>
        </div>
      </div>
    </div>

    <div class="col-lg-8 form-column">
      <%= form_with(model: @profile, local: true, html: { multipart: true }) do |f| %>

        <label class="form-label-custom">Name</label>
        <%= f.text_field :name, class: "form-control-custom" %>

        <label class="form-label-custom">About</label>
        <%= f.text_area :bio, placeholder: "Tell your story", rows: 3, class: "form-control-custom" %>
        
        <label class="form-label-custom">Email</label>
        <input type="email" value="<%= current_user.email %>" class="form-control-custom" readonly>

        <label class="form-label-custom">GitHub</label>
        <%= f.url_field :github_url, placeholder: "https://github.com/username", class: "form-control-custom" %>

        <label class="form-label-custom">LinkedIn</label>
        <%= f.url_field :linkedin_url, placeholder: "https://linkedin.com/in/username", class: "form-control-custom" %>

        <label class="form-label-custom">Favorite Languages</label>
        <%= f.text_field :favorite_languages, placeholder: "e.g. Ruby, JavaScript", class: "form-control-custom" %>

        <label class="form-label-custom">Interested Domains</label>
        <%= f.text_field :domains, placeholder: "e.g. Web Dev, AI", class: "form-control-custom" %>

        <div class="d-flex justify-content-end">
          <%= f.submit "Save", class: "btn btn-save px-4" %>
        </div>

      <% end %>
    </div>
  </div>
</div>

<script>
  function previewAvatar(input) {
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        const preview = document.getElementById('avatarPreview');
        if (preview.tagName === 'IMG') {
          preview.src = e.target.result;
        } else {
          preview.style.backgroundImage = `url(${e.target.result})`;
          preview.textContent = '';
        }
      };
      reader.readAsDataURL(input.files[0]);
    }
  }
</script>
